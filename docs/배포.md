# 배포/운영 가이드

## 실무 환경 즉시 구축/운영 자동화 요약
- `npm install`로 모든 의존성 자동 설치
- `.env`(개발), `.env.production`(운영) 환경변수 분리, docs/env.example 참고
- `pm2 start ecosystem.config.js`로 서버 무중단 자동 실행, `pm2 logs/monit/list`로 실시간 모니터링
- Sentry, Prometheus, Grafana, winston, morgan 등 운영/모니터링 도구 연동
- 운영자는 위 사용법만 따르면 실무 환경을 바로 구축/운영 가능
- 실무 표준 8단계, 운영 배포 체크리스트, 모니터링/자동화 가이드는 README.md와 docs에 최신화

## 실무 표준 8단계 업그레이드 로드맵
1. 관리자 인증 미들웨어 도입 (isAdmin, /api/admin 보호)
2. 에러 핸들러 및 에러 표준화 (errorHandler, 일관된 에러 응답)
3. Swagger 문서 자동화 (swagger.yaml, Swagger UI 연동)
4. Controller-Service 분리 (user, 알림, 예약, 리뷰 등)
5. 테스트 커버리지 확장 (user/notification/reservation/review 등, 정상/실패 케이스)
6. 보안 미들웨어 추가 (helmet, express-rate-limit)
7. RESTful 라우팅 개선 (상세/수정/삭제까지 반영)
8. 운영/모니터링 도구 연동 (winston, morgan, Sentry, Prometheus, pm2, README 가이드)

## 1. Docker 빌드 및 실행

### 백엔드
```bash
cd backend
docker build -t michelin-backend .
docker run -d -p 8000:8000 --env-file .env michelin-backend
```

### 프론트엔드
```bash
cd frontend
docker build -t michelin-frontend .
docker run -d -p 5173:5173 michelin-frontend
```

## 2. docker-compose 통합 실행
```bash
docker-compose up -d --build
```

## 3. Github Actions(CI/CD)
- `.github/workflows/ci.yml` 자동화: main 브랜치 push 시 빌드/배포
- Docker Hub에 이미지 push → NCP 서버에 SSH로 배포
- secrets: DOCKERHUB_USERNAME, DOCKERHUB_TOKEN, NCP_HOST, NCP_USERNAME, NCP_SSH_KEY 등 필요

## 4. NCP 서버 운영
- 서버에 docker, docker-compose, node, mysql 설치 필요
- 환경변수(.env) 및 DB 백업/복구 주기적 관리
- 장애/오류 발생 시 docker logs, docker-compose logs 등으로 진단

## 5. 기타
- 배포/롤백/운영 자동화는 infra/ 폴더 및 docs/ 참고
- 실서비스 운영 전 staging/dev 환경에서 충분히 테스트 권장

## 6. 실무 운영 배포 체크리스트

### 환경변수 분리
- 개발: `.env`
- 운영: `.env.production` (운영용 값)

### CORS
- 운영 프론트 도메인만 허용 (`CORS_ORIGIN=https://yourdomain.com`)

### HTTPS
- 운영 서버는 반드시 HTTPS 적용 (Nginx/Cloudflare 등 프록시 활용)
- API 주소도 `https://`로 환경변수에 입력

### 보안
- .env, .env.production 등은 절대 Git에 커밋하지 않기
- .env.example만 커밋

### 빌드/배포
- 프론트: `npm run build` 후 정적 파일 배포 (Nginx, S3, Vercel 등)
- 백엔드: PM2, Docker, 클라우드 서비스 등으로 배포

### 자동화
- GitHub Actions, Jenkins 등으로 CI/CD 파이프라인 구축 권장

### 모니터링/로깅
- 운영 환경에서는 winston, Sentry, Datadog 등으로 에러/로그 관리 